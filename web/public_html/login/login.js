(()=>{var b=Object.create;var w=Object.defineProperty;var L=Object.getOwnPropertyDescriptor;var C=Object.getOwnPropertyNames;var S=Object.getPrototypeOf,E=Object.prototype.hasOwnProperty;var A=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports);var q=(s,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of C(e))!E.call(s,o)&&o!==t&&w(s,o,{get:()=>e[o],enumerable:!(n=L(e,o))||n.enumerable});return s};var j=(s,e,t)=>(t=s!=null?b(S(s)):{},q(e||!s||!s.__esModule?w(t,"default",{value:s,enumerable:!0}):t,s));var T=A((I,y)=>{"use strict";y.exports=function s(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var n,o,r;if(Array.isArray(e)){if(n=e.length,n!=t.length)return!1;for(o=n;o--!==0;)if(!s(e[o],t[o]))return!1;return!0}if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(o of e.entries())if(!t.has(o[0]))return!1;for(o of e.entries())if(!s(o[1],t.get(o[0])))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(o of e.entries())if(!t.has(o[0]))return!1;return!0}if(ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(n=e.length,n!=t.length)return!1;for(o=n;o--!==0;)if(e[o]!==t[o])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(r=Object.keys(e),n=r.length,n!==Object.keys(t).length)return!1;for(o=n;o--!==0;)if(!Object.prototype.hasOwnProperty.call(t,r[o]))return!1;for(o=n;o--!==0;){var i=r[o];if(!s(e[i],t[i]))return!1}return!0}return e!==e&&t!==t}});var O=j(T(),1);var D={fill:"none",height:26,stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":2,viewBox:"0 0 24 24",width:26};function p(s,e){let t=document.createElementNS("http://www.w3.org/2000/svg",s);for(let n of Object.keys(e))t.setAttribute(n,e[n]);return t}function l(...s){let e=p("svg",D);for(let[t,n]of s)e.append(p(t,n));return e}function x(s){let e=document.createElement("dialog");e.classList.add("dialog-container","popup",s),e.open=!0,e.setAttribute("role","dialog");let t=document.createElement("div");t.classList.add("dialog-window"),e.append(t);let n=document.createElement("div");n.classList.add("dialog-logo"),t.append(n);let o=document.createElement("div");o.classList.add("dialog-heading"),t.append(o);let r=document.createElement("div");r.classList.add("dialog-message"),t.append(r);let i=document.createElement("div");i.classList.add("dialog-workarea"),t.append(i);let c=document.createElement("div");c.classList.add("dialog-buttons"),t.append(c);let m=document.createElement("span");m.className="flexible-space",c.append(m);let f=document.createElement("button");f.classList.add("dialog-dismiss-button"),f.textContent="Cancel",c.append(f);let h=document.createElement("button");return h.textContent="OK",c.append(h),t.addEventListener("keyup",({key:R})=>{R==="Enter"&&h.click()}),{confirm:h,dismiss:f,heading:o,message:r,root:e,workarea:i}}var k=Object.freeze({delete:()=>l(["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2L21 6L3 6"}],["line",{x1:10,x2:10,y1:11,y2:17}],["line",{x1:14,x2:14,y1:11,y2:17}]),inspector:()=>{let s=p("svg",{fill:"none","fill-opacity":1,height:26,stroke:"currentColor",viewBox:"-1 -1 26 26",width:26}),e=p("g",{});return e.append(p("circle",{cx:12,cy:12,r:11,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":2}),p("path",{d:"M 11.88208 4.883789 C 12.326418 4.883789 12.702391 5.039305 13.01001 5.350342 C 13.317628 5.6613785 13.471436 6.035642 13.471436 6.4731445 C 13.471436 6.910647 13.31592 7.283202 13.004883 7.59082 C 12.693846 7.898439 12.319582 8.052246 11.88208 8.052246 C 11.444578 8.052246 11.072023 7.898439 10.764404 7.59082 C 10.456786 7.283202 10.302979 6.910647 10.302979 6.4731445 C 10.302979 6.035642 10.456786 5.6613785 10.764404 5.350342 C 11.072023 5.039305 11.444578 4.883789 11.88208 4.883789 Z M 13.317627 9.528809 L 13.317627 17.126953 C 13.317627 17.803714 13.39624 18.236083 13.553467 18.424072 C 13.710694 18.612061 14.018308 18.719726 14.476318 18.74707 L 14.476318 19.11621 L 9.298096 19.11621 L 9.298096 18.74707 C 9.721926 18.733398 10.036376 18.610353 10.241455 18.37793 C 10.378175 18.220702 10.446533 17.803714 10.446533 17.126953 L 10.446533 11.52832 C 10.446533 10.851559 10.367921 10.41919 10.210693 10.231201 C 10.053466 10.043212 9.74927 9.935547 9.298096 9.908203 L 9.298096 9.528809 Z",fill:"currentColor"})),s.append(e),s},open:()=>l(["path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"}],["line",{x1:12,x2:12,y1:11,y2:17}],["line",{x1:9,x2:15,y1:14,y2:14}]),overflow:()=>l(["line",{x1:3,x2:21,y1:12,y2:12}],["line",{x1:3,x2:21,y1:6,y2:6}],["line",{x1:3,x2:21,y1:18,y2:18}]),pause:()=>l(["rect",{height:16,width:4,x:6,y:4}],["rect",{height:16,width:4,x:14,y:4}]),speedDown:()=>l(["polyline",{points:"6 9 12 15 18 9"}]),speedUp:()=>l(["polyline",{points:"18 15 12 9 6 15"}]),start:()=>l(["polyline",{points:"5 3 19 12 5 21 5 3"}])});var u=()=>{let t=globalThis.location.pathname.split("/").filter(o=>o!==""&&!o.endsWith(".html")).toReversed().indexOf("web"),n="../".repeat(t);return new URL(n,globalThis.location.href).pathname.replace(/\/$/,"")};var _=class s extends EventTarget{constructor(e){super(),this.elements=s._create(e),this.elements.dismiss.addEventListener("click",()=>this._onDismiss()),this.options=e,document.body.append(this.elements.root),this.elements.dismiss.focus()}close(){if(!this.closed){this.elements.root.remove(),this.dispatchEvent(new Event("close"));for(let e of Object.keys(this))delete this[e];this.closed=!0}}_onDismiss(){this.close()}static _create(e){let{heading:t,message:n}=e,o=x("confirm-dialog");return o.confirm.remove(),delete o.confirm,o.heading.textContent=t,o.workarea.textContent=n,o}};var a={_DaemonVersion:"version",_DownSpeedLimit:"speed_limit_down",_DownSpeedLimited:"speed_limit_down_enabled",_JsonRpcVersion:"2.0",_QueueMoveBottom:"queue_move_bottom",_QueueMoveDown:"queue_move_down",_QueueMoveTop:"queue_move_top",_QueueMoveUp:"queue_move_up",_Root:new URL(`${u()}/../rpc`,globalThis.location.href).pathname,_TurtleDownSpeedLimit:"alt_speed_down",_TurtleState:"alt_speed_enabled",_TurtleUpSpeedLimit:"alt_speed_up",_UpSpeedLimit:"speed_limit_up",_UpSpeedLimited:"speed_limit_up_enabled"},g=class s{_connection_alert=null;_session_id="";constructor(e){this._controller=e}sendRequest(e,t,n){let o=new Headers;o.append("cache-control","no-cache"),o.append("content-type","application/json"),o.append("pragma","no-cache"),d.addAuthHeaders(o),this._session_id&&o.append(s._SessionHeader,this._session_id);let r=null;fetch(a._Root,{body:JSON.stringify(e),headers:o,method:"POST"}).then(i=>{switch(r=i,i.status){case 409:{let c=new Error(s._SessionHeader);throw c.header=i.headers.get(s._SessionHeader),c}case 401:return d.redirectToLogin(),null;case 204:return null;default:return i.json()}}).then(i=>{t&&t.call(n,i,r),this._connection_alert&&(this._connection_alert.close(),this._connection_alert=null)}).catch(i=>{if(i.message===s._SessionHeader){this._session_id=i.header,this.sendRequest(e,t,n);return}console.trace(i),this._controller.togglePeriodicSessionRefresh(!1),this._connection_alert=new _({heading:"Connection failed",message:"Could not connect to the server. You may need to reload the page to reconnect."}),this._controller.setCurrentPopup(this._connection_alert)})}loadDaemonPrefs(e,t){let n={id:"webui",jsonrpc:a._JsonRpcVersion,method:"session_get"};this.sendRequest(n,e,t)}checkPort(e,t,n){let o={id:"webui",jsonrpc:a._JsonRpcVersion,method:"port_test",params:{ip_protocol:e}};this.sendRequest(o,t,n)}renameTorrent(e,t,n,o,r){let i={id:"webui",jsonrpc:a._JsonRpcVersion,method:"torrent_rename_path",params:{ids:e,name:n,path:t}};this.sendRequest(i,o,r)}setLabels(e,t,n){let o={ids:e,labels:t};this.sendRequest({id:"webui",jsonrpc:a._JsonRpcVersion,method:"torrent_set",params:o},n)}loadDaemonStats(e,t){let n={id:"webui",jsonrpc:a._JsonRpcVersion,method:"session_stats"};this.sendRequest(n,e,t)}updateTorrents(e,t,n,o){let r={id:"webui",jsonrpc:a._JsonRpcVersion,method:"torrent_get",params:{fields:t,format:"table"}};e&&(r.params.ids=e),this.sendRequest(r,i=>{let{torrents:c,removed:m}=i.result;n.call(o,c,m)})}getFreeSpace(e,t,n){let o={id:"webui",jsonrpc:a._JsonRpcVersion,method:"free_space",params:{path:e}};this.sendRequest(o,r=>{let{path:i,size_bytes:c}=r.result;t.call(n,i,c)})}changeFileCommand(e,t,n){let o={ids:[e]};o[n]=t,this.sendRequest({jsonrpc:a._JsonRpcVersion,method:"torrent_set",params:o},()=>{this._controller.refreshTorrents([e])})}sendTorrentSetRequests(e,t,n,o,r){n||={},n.ids=t;let i={id:"webui",jsonrpc:a._JsonRpcVersion,method:e,params:n};this.sendRequest(i,o,r)}sendTorrentActionRequests(e,t,n,o){this.sendTorrentSetRequests(e,t,null,n,o)}startTorrents(e,t,n,o){let r=t?"torrent_start_now":"torrent_start";this.sendTorrentActionRequests(r,e,n,o)}stopTorrents(e,t,n){this.sendTorrentActionRequests("torrent_stop",e,t,n)}moveTorrents(e,t,n,o){this.sendTorrentSetRequests("torrent_set_location",e,{location:t,move:!0},n,o)}removeTorrents(e,t){let n={jsonrpc:a._JsonRpcVersion,method:"torrent_remove",params:{delete_local_data:t,ids:[]}};if(e)for(let o=0,r=e.length;o<r;++o)n.params.ids.push(e[o].getId());this.sendRequest(n,()=>{this._controller.refreshTorrents()})}verifyTorrents(e,t,n){this.sendTorrentActionRequests("torrent_verify",e,t,n)}reannounceTorrents(e,t,n){this.sendTorrentActionRequests("torrent_reannounce",e,t,n)}addTorrentByUrl(e,t){/^[\da-f]{40}$/i.test(e)&&(e=`magnet:?xt=urn:btih:${e}`);let n={jsonrpc:a._JsonRpcVersion,method:"torrent_add",params:{filename:e,paused:t.paused}};this.sendRequest(n,()=>{this._controller.refreshTorrents()})}savePrefs(e){let t={jsonrpc:a._JsonRpcVersion,method:"session_set",params:e};this.sendRequest(t,()=>{this._controller.loadDaemonPrefs()})}updateBlocklist(){let e={jsonrpc:a._JsonRpcVersion,method:"blocklist_update"};this.sendRequest(e,()=>{this._controller.loadDaemonPrefs()})}moveTorrentsToTop(e,t,n){this.sendTorrentActionRequests(a._QueueMoveTop,e,t,n)}moveTorrentsToBottom(e,t,n){this.sendTorrentActionRequests(a._QueueMoveBottom,e,t,n)}moveTorrentsUp(e,t,n){this.sendTorrentActionRequests(a._QueueMoveUp,e,t,n)}moveTorrentsDown(e,t,n){this.sendTorrentActionRequests(a._QueueMoveDown,e,t,n)}};g._SessionHeader="X-Transmission-Session-Id";var v="credentials",d={addAuthHeaders(s,e=this.loadCredentials()){if(e){let t=btoa(`${e.username}:${e.password}`);s.append("Authorization",`Basic ${t}`)}s.append("TransmissionRPC-Suppress-Basic-Auth-Popup","true")},clearCredentials(){localStorage.removeItem(v)},loadCredentials(){let s=localStorage.getItem(v);if(s===null)return null;let e=JSON.parse(s);return e.createdAt=new Date(e.createdAt),e},redirectToLogin(){globalThis.location.href=`${u()}/login/index.html`},storeCredentials(s,e){localStorage.setItem(v,JSON.stringify({createdAt:new Date().toISOString(),password:e,username:s}))},async testCredentials(s){let e=new Headers;this.addAuthHeaders(e,s);let t=await fetch(a._Root,{headers:e,method:"POST"});if(t.status===401)return!1;if(t.status!==204&&t.status!==409)throw new Error("Unexpected response from RPC auth check",t.status);return!0}};document.addEventListener("DOMContentLoaded",async()=>{await d.testCredentials(d.loadCredentials())&&(globalThis.location.href=u()),document.querySelector("#login-form").addEventListener("submit",async t=>{t.preventDefault(),document.querySelector("#login-error").classList.remove("draw-attention");let n=document.querySelector("#username").value,o=document.querySelector("#password").value;if(!await d.testCredentials({password:o,username:n})){document.querySelector("#login-error").classList.remove("hidden"),document.querySelector("#login-error").classList.add("draw-attention");return}d.storeCredentials(n,o),globalThis.location.href=u()})});})();
//# sourceMappingURL=login.js.map
